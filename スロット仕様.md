# **パチスロWebシミュレーター 仕様書**

## **1. プロジェクト概要**
- **プロジェクト名**：パチスロWebシミュレーター  
- **開発環境**：Web（HTML, CSS, JavaScript）  
- **対象プラットフォーム**：PC・スマホ・タブレット対応  
- **課金要素**：なし  
- **データ保存**：ローカルストレージ（IndexedDB）  
- **目的**：実機と同様の挙動を再現し、ユーザーが自由にプレイできるWebシミュレーター  

---

## **2. 機能要件**
### **(1) リール制御**
| 項目 | 仕様 |
|------|------|
| **リール数** | 3リール |
| **リール回転方式** | JavaScript の `requestAnimationFrame()` を使用し、スムーズな回転を実現 |
| **ストップ制御** | 3リール独立してストップ可能（1リールずつ手動停止） |
| **目押し精度** | `stopReel(reelIndex, stopPosition)` で停止位置を制御し、押し順精度を反映 |
| **リール画像** | スプライトシート（リール全体を1つの画像として配置し、CSSで制御） |
| **リール始動タイミング** | ボタン押下後にランダムなフレーム数の遅延を発生させる |

---

### **(2) 小役・ボーナス抽選**
| 項目 | 仕様 |
|------|------|
| **抽選方式** | `Math.random()` を使用した乱数抽選 |
| **役の種類** | リプレイ / リーチ目 / ベル / スイカ / チェリー / 確定役 |
| **各役の成立確率** | 設定ごとに確率を変動させる（設定1〜6） |
| **リール制御** | 成立役に応じてリールの停止制御（フラグ成立後に演出発生） |

#### **(2-1) 設定別ボーナス確率**
| 設定 | BIG確率 | REG確率 |
|------|---------|---------|
| 設定1 | 1/300  | 1/400   |
| 設定2 | 1/280  | 1/380   |
| 設定3 | 1/260  | 1/360   |
| 設定4 | 1/240  | 1/340   |
| 設定5 | 1/220  | 1/320   |
| 設定6 | 1/200  | 1/300   |

---

### **(3) 演出制御**
| 項目 | 仕様 |
|------|------|
| **告知演出** | チャンスランプ点灯、フラッシュ、リール制御 |
| **リーチ目** | 特定の停止型でボーナスを告知 |
| **プレミア演出** | 確定演出をランダム発生（1/5000） |
| **フリーズ** | 特定条件（1/8192）で発生し、リールを一定時間停止 |

---

### **(4) UI・デザイン**
| 画面 | 要素 | 仕様 |
|------|------|------|
| **メイン画面** | リール | 3リール表示（スプライトシート） |
| | ボタン | スタート / ストップ（3つ） / 設定変更 |
| | クレジット表示 | 現在のメダル枚数を表示 |
| | スランプグラフ | 差枚データを元に折れ線グラフを表示 |
| **設定画面** | 設定選択 | 設定1〜6を選択可能 |
| | データリセット | スランプグラフのデータ削除 |

---

### **(5) スランプグラフ**
| 項目 | 仕様 |
|------|------|
| **データ保存方法** | IndexedDB または `localStorage` |
| **保存データ** | 差枚データ、回転数、ボーナス回数 |
| **表示方法** | Canvas または Chart.js を使用して折れ線グラフを描画 |
| **更新タイミング** | 1回転ごとにデータを更新 |

---

## **3. 技術仕様**
### **(1) フロントエンド**
| 技術 | 使用用途 |
|------|---------|
| HTML | UIの構築 |
| CSS | デザインとアニメーション制御 |
| JavaScript | リール制御・抽選ロジック |

### **(2) リール制御の詳細**
#### **リール回転の仕組み**
1. スタートボタン押下で `startReels()` を実行
2. `requestAnimationFrame()` で一定速度でリールを回転
3. ストップボタン押下で `stopReel(reelIndex, stopPosition)` を実行
4. 指定位置でリールを停止させる

#### **JavaScriptコード（サンプル）**
```js
function startReels() {
    reels.forEach((reel, index) => {
        reel.isSpinning = true;
        spinReel(reel);
    });
}

function spinReel(reel) {
    if (!reel.isSpinning) return;
    reel.position += 1; // 1フレームごとに移動
    if (reel.position >= reel.maxPosition) {
        reel.position = 0; // ループ
    }
    requestAnimationFrame(() => spinReel(reel));
}

function stopReel(reelIndex, stopPosition) {
    reels[reelIndex].isSpinning = false;
    reels[reelIndex].position = stopPosition;
}
```

---

### **(3) データ構造**
#### **リールデータ**
```json
{
    "reels": [
        ["ベル", "リプレイ", "スイカ", "チェリー", "ベル", "リプレイ"],
        ["リプレイ", "スイカ", "チェリー", "ベル", "リプレイ", "ベル"],
        ["スイカ", "チェリー", "ベル", "リプレイ", "ベル", "リプレイ"]
    ]
}
```

#### **スランプデータ**
```json
{
    "totalGames": 1000,
    "bigCount": 10,
    "regCount": 5,
    "coinDifference": -300
}
```

---

## **4. 今後の作業**
1. **リール回転アニメーションの実装**
2. **小役抽選ロジックの組み込み**
3. **演出制御の作成**
4. **スランプグラフの描画**
5. **UIデザインの調整**

